@inherits Fluxor.Blazor.Web.Components.FluxorComponent

<MudCard Class="rounded my-3 mx-3" Elevation="7" Outlined="true">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h6">Composition Configuration</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <MudGrid>
            <MudItem xs="12" sm="6" md="3" lg="3" xl="3" xxl="3">
                <SelectWithPopover T="NoteName"
                                   Items="CompositionConfigurationService.ConfigurableRootNotes"
                                   Label="Tonic Note"
                                   ValueProvider="() => RootNote"
                                   ValueChanged="HandleTonicNoteChange"
                                   ConvertToDisplay="noteName => noteName.ToSpaceSeparatedString()">
                    <PopoverContent>
                        <MudText>The <MudLink Color="Color.Tertiary" Href="https://en.wikipedia.org/wiki/Tonic_(music)">tonic</MudLink> of the scale used in the composition.</MudText>
                    </PopoverContent>
                </SelectWithPopover>
            </MudItem>
            <MudItem xs="12" sm="6" md="3" lg="3" xl="3" xxl="3">
                <SelectWithPopover T="Mode"
                                   Items="CompositionConfigurationService.ConfigurableScaleModes"
                                   Label="Mode"
                                   ValueProvider="() => Mode"
                                   ValueChanged="HandleModeChange"
                                   ConvertToDisplay="mode => mode.ToSpaceSeparatedString()">
                    <PopoverContent>
                        <MudText>The <MudLink Color="Color.Tertiary" Href="https://en.wikipedia.org/wiki/Mode_(music)">mode</MudLink> of the scale used in the composition.</MudText>
                    </PopoverContent>
                </SelectWithPopover>
            </MudItem>
            <MudItem xs="12" sm="6" md="3" lg="3" xl="3" xxl="3">
                <SelectWithPopover T="Meter"
                                   Items="CompositionConfigurationService.ConfigurableMeters"
                                   Label="Meter"
                                   ValueProvider="() => Meter"
                                   ValueChanged="HandleMeterChange"
                                   ConvertToDisplay="meter => meter.AsString()">
                    <PopoverContent>
                        <MudText>The <MudLink Color="Color.Tertiary" Href="https://en.wikipedia.org/wiki/Metre_(music)">meter</MudLink> of the composition.</MudText>
                    </PopoverContent>
                </SelectWithPopover>
            </MudItem>
            <MudItem xs="12" sm="6" md="3" lg="3" xl="3" xxl="3">
                <NumericInputWithPopover T="int"
                                         Label="Minimum Measures"
                                         ValueChanged="HandleCompositionLengthChange"
                                         ValueProvider="() => MinimumMeasures">
                    <PopoverContent>
                        <MudText>The minimum number of <MudLink Color="Color.Tertiary" Href="https://en.wikipedia.org/wiki/Bar_(music)">measures</MudLink> in the composition.</MudText>
                    </PopoverContent>
                </NumericInputWithPopover>
            </MudItem>
        </MudGrid>
    </MudCardContent>
</MudCard>

@code {
    private NoteName RootNote => CompositionConfigurationState.Value.TonicNote;

    private Mode Mode => CompositionConfigurationState.Value.Mode;

    private Meter Meter => CompositionConfigurationState.Value.Meter;

    private int MinimumMeasures => CompositionConfigurationState.Value.MinimumMeasures;

    private void HandleTonicNoteChange(NoteName note) => Dispatcher.Dispatch(new UpdateCompositionConfiguration(note, Mode, Meter, MinimumMeasures));

    private void HandleModeChange(Mode mode) => Dispatcher.Dispatch(new UpdateCompositionConfiguration(RootNote, mode, Meter, MinimumMeasures));

    private void HandleMeterChange(Meter meter) => Dispatcher.Dispatch(new UpdateCompositionConfiguration(RootNote, Mode, meter, MinimumMeasures));

    private void HandleCompositionLengthChange(int length) => Dispatcher.Dispatch(new UpdateCompositionConfiguration(RootNote, Mode, Meter, length));
}
